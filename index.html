<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- FOUC & Anti-Dup -->
    <style>
        .upload-section {
            display: none !important
        }
    </style>
    <script>(function () { const n = Date.now(), l = localStorage.getItem("ts"); if (l && (n - l < 2000)) { document.write("<div style=\"display:flex;justify-content:center;align-items:center;height:100vh;\">âš ï¸ Duplicate...</div>"); window.stop(); setTimeout(() => window.close(), 100); throw "Dup"; } localStorage.setItem("ts", n); const bc = new BroadcastChannel("lock"); bc.postMessage("chk"); bc.onmessage = e => { if (e.data === "ali") { document.write("âš ï¸ Already running"); window.stop(); self.close(); } if (e.data === "chk") bc.postMessage("ali"); }; })();</script>
    <title>NotebookLM äº’åŠ¨é—ªå¡ - æè‡´æ²‰æµ¸ç‰ˆ</title>

    <!-- MathJax é…ç½® -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            },
            options: {
                enableMenu: false
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-svg.js"></script>

    <!-- MediaPipe AI åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=Outfit:wght@300;400;600;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/style.css?v=10">
</head>

<body>
    <video id="input_video" playsinline autoplay muted></video>

    <div id="gesture-feedback"></div>
    <div id="toast" class="toast">è¿™æ˜¯ä¸€ä¸ªæç¤ºæ¶ˆæ¯</div>

    <div id="calibration-modal" class="modal-overlay" style="z-index: 4000;">
        <div class="modal-content">
            <div class="modal-title">âœŒï¸ æ‰‹åŠ¿æ ¡å‡†</div>
            <p style="color:#7F8C8D; font-size:14px; margin-bottom:20px;">è¯·å¯¹ç€æ‘„åƒå¤´åšå‡º <strong>OKæ‰‹åŠ¿</strong><br>ä¿æŒç¨³å®šå³å¯è‡ªåŠ¨å½•å…¥ã€‚
            </p>
            <div class="calibration-video-container">
                <canvas id="calibration-canvas" width="640" height="480"></canvas>
                <div class="calibration-status" id="cal-status">å¯»æ‰¾æ‰‹éƒ¨...</div>
            </div>
            <button class="modal-btn" id="cancel-calib-btn"
                style="background: white; border:2px solid #eee; color: #7F8C8D; box-shadow: 0 4px 0 #eee;">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="rendering-modal" class="modal-overlay" style="z-index: 3000;">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px; color: #2ECC71;" id="modal-title">å‡†å¤‡å­¦ä¹ ç¯å¢ƒ...</h3>
            <p style="margin-bottom: 20px; color: #7F8C8D;">æ­£åœ¨ä¼˜åŒ–æ•°å­¦å…¬å¼ä¸æ¸²æŸ“èµ„æº</p>
            <div
                style="width: 100%; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                <div id="render-bar" style="width: 0%; height: 100%; background: #2ECC71; transition: width 0.3s;">
                </div>
            </div>
            <div id="render-text" style="font-size: 12px; color: #999; font-family: monospace;">0%</div>
        </div>
    </div>

    <div id="flow-start-screen">
        <div class="breathing-circle"></div>
        <div class="flow-title" style="font-size: 28px; font-weight: 300; margin-bottom: 15px;">å‡†å¤‡è¿›å…¥å¿ƒæµ</div>
        <div class="flow-subtitle"
            style="font-size: 15px; color: #999; margin-bottom: 30px; font-weight: 300; max-width: 300px; line-height: 1.6;">
            æ·±å‘¼å¸ï¼Œæ’é™¤æ‚å¿µã€‚<br>è®©æ€ç»ªæ…¢ä¸‹æ¥ï¼Œä¸“æ³¨äºå½“ä¸‹çš„æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚</div>

        <button id="fullscreen-hint-btn" class="secondary-btn"
            style="position: fixed; top: 12%; left: 50%; transform: translateX(-50%); z-index: 9999; font-size: 14px; padding: 10px 24px; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.3); color: #fff; border-radius: 30px; cursor: pointer; backdrop-filter: blur(5px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: opacity 1s ease;">
            ğŸ“º ç‚¹å‡»å…¨å±è¿›å…¥æ²‰æµ¸æ¨¡å¼ (F11)
        </button>
        <button class="start-flow-btn">å¼€å§‹ä¸“æ³¨</button>
    </div>

    <div id="celebration-overlay">
        <div class="celebration-content">
            <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
            <h2 style="font-size: 32px; color: #2C3E50; margin-bottom: 10px; font-family: 'Comic Sans MS';">Great Job!
            </h2>
            <p style="color: #7F8C8D; margin-bottom: 30px; font-size: 18px;">ä½ å·²å®Œæˆå½“å‰æ‰€æœ‰å†…å®¹çš„å­¦ä¹ ã€‚</p>
            <button class="action-btn primary"
                style="width: auto; padding: 15px 50px; font-size: 18px; margin: 0 auto;">Replay Again</button>
        </div>
    </div>

    <div id="play-settings-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-title">å¿ƒæµèŠ‚å¥è®¾ç½®</div>
            <div class="settings-group">
                <span class="settings-label">æ¨¡å¼</span>
                <div class="settings-options">
                    <div class="settings-option selected">ä»…çœ‹é¢˜ç›®</div>
                    <div class="settings-option">é¢˜ç›®+ç­”æ¡ˆ</div>
                </div>
            </div>
            <div class="settings-group">
                <span class="settings-label">æ­£é¢åœç•™æ—¶é—´ (çœ‹é¢˜)</span>
                <div class="range-container">
                    <input type="range" min="1" max="20" value="3" class="range-slider" id="interval-slider">
                    <span class="range-value" id="interval-display"
                        style="color: #2ECC71; font-weight:bold; width: 40px;">3s</span>
                </div>
            </div>
            <div class="settings-group" id="answer-time-group">
                <span class="settings-label">èƒŒé¢åœç•™æ—¶é—´ (çœ‹ç­”æ¡ˆ)</span>
                <div class="range-container">
                    <input type="range" min="1" max="20" value="3" class="range-slider" id="answer-interval-slider">
                    <span class="range-value" id="answer-interval-display"
                        style="color: #2ECC71; font-weight:bold; width: 40px;">3s</span>
                </div>
            </div>
            <div class="settings-group"
                style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding: 8px 12px; background: #F8F9FA; border-radius: 12px;">
                <span class="settings-label" style="margin-bottom: 0; color: #555;">è‡ªåŠ¨è·³è¿‡å·²æŒæ¡</span>
                <label class="switch">
                    <input type="checkbox" id="skip-mastered-toggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="settings-group"
                style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding: 8px 12px; background: #F8F9FA; border-radius: 12px;">
                <span class="settings-label" style="margin-bottom: 0; color: #555;">æŒæ¡åè‡ªåŠ¨è·³è½¬</span>
                <label class="switch">
                    <input type="checkbox" id="auto-next-toggle" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <button class="modal-btn">ä¿å­˜è®¾ç½®</button>
        </div>
    </div>

    <!-- Sound Settings Modal -->
    <div id="sound-settings-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 380px;">
            <div class="modal-title">ğŸ”Š å£°éŸ³è®¾ç½®</div>

            <div class="settings-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span class="settings-label" style="margin-bottom: 0;">ğŸµ èƒŒæ™¯éŸ³ä¹</span>
                    <label class="switch">
                        <input type="checkbox" id="music-toggle" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="range-container">
                    <input type="range" min="0" max="100" value="60" class="range-slider" id="music-volume-slider">
                    <span class="range-value" id="music-volume-display"
                        style="color: #3498DB; font-weight:bold; width: 45px;">60%</span>
                </div>
            </div>

            <div class="settings-group">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span class="settings-label" style="margin-bottom: 0;">ğŸ”” éŸ³æ•ˆ</span>
                    <label class="switch">
                        <input type="checkbox" id="sfx-toggle" checked>
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="range-container">
                    <input type="range" min="0" max="100" value="80" class="range-slider" id="sfx-volume-slider">
                    <span class="range-value" id="sfx-volume-display"
                        style="color: #2ECC71; font-weight:bold; width: 45px;">80%</span>
                </div>
            </div>

            <button class="modal-btn" id="sound-settings-save"
                style="background: #3498DB; box-shadow: 0 6px 0 #2980B9;">ä¿å­˜</button>
        </div>
    </div>

    <div class="modal-overlay" id="help-modal">
        <div class="modal-content" style="max-width: 450px; text-align: left;">
            <div class="modal-title" style="text-align: center; margin-bottom: 25px;">ä½¿ç”¨æŒ‡å—</div>

            <!-- Desktop: Camera Gesture Control -->
            <div id="help-gesture-desktop" style="margin-bottom: 25px;">
                <h4 style="color: #2C3E50; margin-bottom: 12px; display:flex; align-items:center; gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                        <circle cx="12" cy="13" r="4" />
                    </svg>
                    æ‰‹åŠ¿æ§åˆ¶ (ä»…æ¡Œé¢ç«¯)
                </h4>
                <div
                    style="text-align:center; background:#FDF6E3; padding:15px; border-radius:12px; border:2px solid #eee; display: flex; justify-content: space-around;">
                    <div style="text-align: center;">
                        <div style="font-size:32px; margin-bottom:8px;">ğŸ‘Œ</div>
                        <div style="font-size:12px; font-weight:bold; color:#2ECC71;">å•æ‰‹ OK</div>
                        <div style="font-size:10px; color:#7F8C8D;">æ ‡è®°å·²æŒæ¡</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size:32px; margin-bottom:8px;">ğŸ‘</div>
                        <div style="font-size:12px; font-weight:bold; color:#3498DB;">åŒæ‰‹æ‘Šå¼€</div>
                        <div style="font-size:10px; color:#7F8C8D;">ä¸ä¼š/ä¸‹ä¸€ä¸ª</div>
                    </div>
                </div>
            </div>

            <!-- Mobile: Touch Gesture Control -->
            <div id="help-gesture-mobile" style="margin-bottom: 25px; display: none;">
                <h4 style="color: #2C3E50; margin-bottom: 12px; display:flex; align-items:center; gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z" />
                        <path d="M12 6v6l4 2" />
                    </svg>
                    è§¦æ§æ‰‹åŠ¿
                </h4>
                <div
                    style="text-align:center; background:#FDF6E3; padding:15px; border-radius:12px; border:2px solid #eee; display: flex; justify-content: space-around;">
                    <div style="text-align: center;">
                        <div style="font-size:32px; margin-bottom:8px;">ğŸ‘†</div>
                        <div style="font-size:12px; font-weight:bold; color:#9B59B6;">ç‚¹å‡»å¡ç‰‡</div>
                        <div style="font-size:10px; color:#7F8C8D;">ç¿»è½¬æŸ¥çœ‹ç­”æ¡ˆ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size:32px; margin-bottom:8px;">ğŸ‘ˆğŸ‘‰</div>
                        <div style="font-size:12px; font-weight:bold; color:#3498DB;">å·¦å³æ»‘åŠ¨</div>
                        <div style="font-size:10px; color:#7F8C8D;">åˆ‡æ¢é¢˜ç›®</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size:32px; margin-bottom:8px;">ğŸ‘‡</div>
                        <div style="font-size:12px; font-weight:bold; color:#2ECC71;">é•¿æŒ‰</div>
                        <div style="font-size:10px; color:#7F8C8D;">æ ‡è®°å·²æŒæ¡</div>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 25px;">
                <h4 style="color: #2C3E50; margin-bottom: 10px; display:flex; align-items:center; gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" />
                        <path d="M12 8v8" />
                    </svg>
                    æè‡´æ²‰æµ¸æ¨¡å¼
                </h4>
                <ul style="color: #7F8C8D; font-size: 13px; line-height: 1.8; list-style: none; padding-left: 5px;">
                    <li>ğŸ¤« <strong>è‡ªåŠ¨éšè—</strong>ï¼šé™æ­¢ 3 ç§’åï¼Œé™¤å¡ç‰‡å¤–æ‰€æœ‰å†…å®¹æ¶ˆå¤±ã€‚</li>
                    <li>ğŸ“± <strong>ç§»åŠ¨ç«¯å”¤é†’</strong>ï¼šç‚¹å‡»å±å¹•é¡¶éƒ¨æˆ–åº•éƒ¨è¾¹ç¼˜ã€‚</li>
                    <li>ğŸ–¥ï¸ <strong>æ¡Œé¢ç«¯å”¤é†’</strong>ï¼šç§»åŠ¨é¼ æ ‡å³å¯æ¢å¤ç•Œé¢ã€‚</li>
                </ul>
            </div>

            <button class="modal-btn"
                style="margin-top: 15px; background: #2ECC71; box-shadow: 0 6px 0 #27AE60;">å¼€å§‹å­¦ä¹ </button>
        </div>
    </div>
    <script>
        // Show appropriate help section based on device
        (function () {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                document.getElementById('help-gesture-desktop').style.display = 'none';
                document.getElementById('help-gesture-mobile').style.display = 'block';
            }
        })();
    </script>

    <div class="container">
        <div class="header">
            <button id="camera-btn" class="top-btn" title="å¼€å¯æ‰‹åŠ¿æ§åˆ¶" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                    <circle cx="12" cy="13" r="4" />
                </svg>
            </button>
            <button id="play-btn" class="top-btn" title="æ’­æ”¾/æš‚åœ" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="5 3 19 12 5 21 5 3" />
                </svg>
            </button>
            <button id="settings-btn" class="top-btn" title="æ’­æ”¾è®¾ç½®" style="display: none;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
            </button>
            <button id="help-btn" class="top-btn" title="æŸ¥çœ‹å¸®åŠ©">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                    <path d="M12 17h.01" />
                </svg>
            </button>
            <button id="sound-btn" class="top-btn active" title="å¼€å¯/å…³é—­éŸ³æ•ˆ">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" />
                </svg>
            </button>
        </div>

        <div class="upload-section" id="upload-box">
            <h3 style="margin-bottom:15px; font-weight:800; color:#2C3E50; font-size:24px;">å¯¼å…¥é¢˜åº“</h3>
            <p style="color:#7F8C8D; font-size:16px;">è¯·ä¸Šä¼  CSV æ–‡ä»¶ (æ ¼å¼: é—®é¢˜,ç­”æ¡ˆ)</p>
            <input type="file" id="file-input" accept=".csv">
            <label for="file-input" class="upload-btn">é€‰æ‹© CSV æ–‡ä»¶</label>
        </div>

        <div class="card-section" id="app-box">
            <div class="card-container">
                <div class="card" id="flashcard">
                    <div class="card-face card-front">
                        <span class="card-label">Question</span>
                        <div class="card-content" id="q-text"></div>
                        <div class="card-hint">Click to flip</div>
                    </div>
                    <div class="card-face card-back">
                        <span class="card-label">Answer</span>
                        <div class="card-content" id="a-text"></div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="nav-bar">
                    <button class="nav-btn" id="prev-btn" title="ä¸Šä¸€ä¸ª (åŒå‡»è·³è½¬æœªæŒæ¡)">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                    </button>
                    <div class="progress-text">
                        <span id="progress-str">1 / 10</span>
                        <span class="progress-sub">å·²æŒæ¡: 0</span>
                    </div>
                    <button class="nav-btn" id="next-btn" title="ä¸‹ä¸€ä¸ª (åŒå‡»è·³è½¬æœªæŒæ¡)">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m9 18 6-6-6-6" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="controls">
                <button class="action-btn" id="mode-btn" title="åˆ‡æ¢é¡ºåº/ä¹±åº">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.6" />
                        <path d="m21.5 10.3.6-6.6-6.6.6" />
                        <path d="M2 6h1.4c1.3 0 2.5.6 3.3 1.7l1.7 1.9" />
                        <path d="m21.5 13.7.6 6.6-6.6-.6" />
                        <path d="M12.7 14.3l8.2 7.3" />
                        <path d="M22 6l-6.6.6" />
                    </svg>
                    <span>ä¹±åº</span>
                </button>

                <button class="action-btn" id="mark-btn" title="æ ‡è®°ä¸ºå·²æŒæ¡ (Enter)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                    </svg>
                    <span>æŒæ¡</span>
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js?v=10"></script>
</body>

</html>